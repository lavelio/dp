"use strict";(self.webpackChunkoffice_addin_taskpane_react=self.webpackChunkoffice_addin_taskpane_react||[]).push([[926],{88078:function(e,t,n){var a=n(96540),r=n(5338),l=n(44541),o=n(29105),i=n(63171),s=n(97156),c=n(83128),u=n(96668),d=n(19448),p=n(6007),m=n(70296),f=n(52285),g=n(26117),h=n(68978),y=n(1419),v=n(86366),b=n(48352),x=n(10900),w=n(24938),E=n(27037),O=n(9265),S=n(27395),A=n(69563);const D=(0,l.n)({dialog:{marginTop:"10px",marginRight:"10px",marginLeft:"10px"},dialog_apply:{backgroundColor:"red"}});var N=e=>{const t=D();return a.createElement(m.l,{modalType:e.type,defaultOpen:!0,onOpenChange:()=>{e.onResultDialog("cancel")}},a.createElement(f.E,{className:t.dialog},a.createElement(w.R,null,a.createElement(E.L,null,e.title),a.createElement(O.C,null,(0,x.Ay)(e.content)),a.createElement(S.i,null,a.createElement(A.z,{disableButtonEnhancement:!0},a.createElement(b.$,{appearance:"secondary",autoFocus:!0},e.closeName)),e.showPrimary&&a.createElement(b.$,{appearance:"primary",className:t.dialog_apply,onClick:()=>{e.onResultDialog("ok")}},"Löschen")))))},P=n(64583).Promise,_=(e,t,n)=>new P(((a,r)=>{var l=e=>{try{i(n.next(e))}catch(e){r(e)}},o=e=>{try{i(n.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):P.resolve(e.value).then(l,o);i((n=n.apply(e,t)).next())}));function C(e,t,n,a,r,l,o){return _(this,arguments,(function*(e,t,n,a,r,l,o,i=[],s=[],c){var u="https://fg.server.lavel.io"+e;const d={"Content-Type":"application/json",authorization:t},p={messages:[{subject:n,body:r,sender:a,recipients:i,cc:s,thread_body:r,raw_content:null}],user_input:l,target_language:"german",user_email:o};if(c&&c.length>0){const e=c.map((e=>_(this,null,(function*(){const t=yield function(e){return new P(((t,n)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=e=>n(e)}))}(e);return{name:e.name,type:e.type,content:t}})))),t=yield P.all(e);p.files=t}var m={method:"POST",headers:d,body:JSON.stringify(p),muteHttpExceptions:!0},f=yield fetch(u,m);if(![200,400,401,404,502].includes(f.status))return{detail:`Wrong response code: ${f.status}`};try{return yield f.json()}catch(e){return{detail:`Invalid JSON: ${e}`}}}))}var k=n(64583).Promise,I=(e,t,n)=>new k(((a,r)=>{var l=e=>{try{i(n.next(e))}catch(e){r(e)}},o=e=>{try{i(n.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):k.resolve(e.value).then(l,o);i((n=n.apply(e,t)).next())}));var R=n(79804),j=n(65892),T=n(94796),F=n(80827),z=n(48697),B=n(64583).Promise,$=Object.defineProperty,L=Object.defineProperties,K=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable,U=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t)=>{for(var n in t||(t={}))Z.call(t,n)&&U(e,n,t[n]);if(M)for(var n of M(t))J.call(t,n)&&U(e,n,t[n]);return e},H=(e,t)=>L(e,K(t)),W=(e,t,n)=>new B(((a,r)=>{var l=e=>{try{i(n.next(e))}catch(e){r(e)}},o=e=>{try{i(n.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):B.resolve(e.value).then(l,o);i((n=n.apply(e,t)).next())}));const V="fg-chat-ocr",G=(0,l.n)({root:{flexDirection:"column",display:"flex",paddingLeft:"10px",paddingRight:"10px"},answer_dialog:{flexDirection:"column",display:"flex"},dialog_field:{fontWeight:600,marginBottom:"15px"},button_send:{width:"100%",marginBottom:"10px"},spinner:{width:"75%"},pencil:{marginLeft:"2px",marginRight:"4px"},dropZone:{border:"2px dashed #ccc",borderRadius:"4px",padding:"20px",textAlign:"center",marginBottom:"15px",cursor:"pointer",transition:"all 0.3s ease"},dropZoneActive:{border:"2px dashed #0078d4",backgroundColor:"rgba(0, 120, 212, 0.05)"},dropZoneSuccess:{border:"2px dashed #107c10",backgroundColor:"rgba(16, 124, 16, 0.05)"},filePreview:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:"#f3f2f1",borderRadius:"4px",marginBottom:"15px"},fileIcon:{marginRight:"8px",color:"#0078d4"},fileName:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},removeButton:{cursor:"pointer",color:"#605e5c","&:hover":{color:"#d13438"}},divider:{margin:"15px 0"},fileUploadInfo:{marginBottom:"10px",fontSize:"12px",color:"#605e5c"},ocrCompletedMessage:{color:"green",display:"block",marginTop:"5px"},checkIcon:{verticalAlign:"middle",marginRight:"5px"},hiddenInput:{display:"none"}});var Q=()=>{const e=G(),[t,n]=a.useState({show:!1,text:""}),[r,l]=a.useState(!1),[i,s]=a.useState({current:"",state:"none"}),[x,w]=a.useState(""),[E,O]=a.useState(!1),[S,A]=a.useState([]),[D,P]=a.useState(!1),[_,k]=a.useState(!1),[B,$]=a.useState(!1),[L,K]=a.useState([]),M=a.useRef(null),{dispatchToast:Z}=(0,c.J)(),J="Eingeben..";a.useEffect((()=>{W(void 0,null,(function*(){var e=localStorage.getItem("answer");e&&""!=e||(e=J),s({current:e,state:"none"})}))}),[]);const U=e=>W(void 0,null,(function*(){try{const t=localStorage.getItem("apiKey")||"";if(""===t)return n({show:!0,text:"API-Schlüssel nicht angegeben"}),void k(!1);const r=e.map((e=>({filename:e,bucket:V}))),l=yield fetch("https://fg.server.lavel.io/outlook/ocr-detect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({files:r})}),o=yield l.json();if(!l.ok)throw new Error(o.detail||"OCR processing failed");if(o.documents&&o.documents.length>0){const e=o.documents.map((e=>e.text)).join("\n\n");e&&w((t=>t?`${t}\n\n${e}`:e))}k(!1),$(!0),Z(a.createElement(u.y,null,a.createElement(d.S,{media:a.createElement(R.A,{color:"green"})},"OCR erfolgreich abgeschlossen")),{position:"top",timeout:5e3})}catch(e){n({show:!0,text:`OCR-Fehler: ${e.message}`}),k(!1)}}));a.useEffect((()=>{S.length>0&&!D&&!_&&!B&&W(void 0,null,(function*(){if(0!==S.length){P(!0),k(!0);try{const e=[],t=[],n=[];for(const a of S){const r=yield fetch("https://fg.server.lavel.io/generate_presigned_upload_url",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("apiKey")||""},body:JSON.stringify({filename:a.name,content_type:a.type,bucket_name:V})});if(!r.ok)throw new Error(`Failed to get presigned URL: ${r.statusText}`);const l=yield r.json(),o=yield fetch(l.url,{method:"PUT",headers:{"Content-Type":a.type},body:a});if(!o.ok)throw new Error(`Failed to upload ${a.name}: ${o.statusText}`);e.push(l.filename),t.push(l.uuid),n.push(l.filetype)}K(e),P(!1),yield U(t.map(((e,t)=>`${e}${n[t]}`)))}catch(e){n({show:!0,text:`Fehler beim Hochladen: ${e.message}`}),P(!1),k(!1)}}}))}),[S,D,_,B]);return a.createElement("div",{className:e.root,role:"tabpanel","aria-labelledby":"Settings"},a.createElement(p.l,null),(r||D||_)&&a.createElement(m.l,{defaultOpen:!0},a.createElement(f.E,{className:e.spinner},a.createElement(g.y,{autoFocus:!0,labelPosition:"after",label:D?"Dateien werden hochgeladen...":_?"OCR-Verarbeitung läuft...":"Loading..."}))),t.show&&a.createElement(N,{type:"alert",title:"Fehler",content:t.text,closeName:"OK",showPrimary:!1,onResultDialog:()=>{l(!1),n(H(q({},t),{show:!1}))}}),a.createElement("div",{className:e.answer_dialog},a.createElement(h.D,{className:e.dialog_field,label:a.createElement(a.Fragment,null,a.createElement(j.A,{size:18,className:e.pencil})," Nutzer Input"),validationState:i.state,validationMessage:"Kurze Antwort eingeben",required:!0},a.createElement(y.T,{value:i.current,rows:10,placeholder:"Kurzen Text eingeben..",size:"large",resize:"vertical",onChange:e=>{const t=e.target.value;s(H(q({},i),{current:t})),w(t)}})),a.createElement(o.c,{className:e.divider}),a.createElement(v.E,{className:e.fileUploadInfo},"Laden Sie bis zu 5 PDF-Dateien hoch, um Text zu extrahieren und in die Anfrage einzubeziehen"),a.createElement("div",{ref:M,className:`${e.dropZone} ${E?e.dropZoneActive:""} ${B?e.dropZoneSuccess:""}`,onDragOver:e=>{e.preventDefault(),O(!0)},onDragLeave:e=>{e.preventDefault(),O(!1)},onDrop:e=>{if(e.preventDefault(),O(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=Array.from(e.dataTransfer.files),a=t.filter((e=>"application/pdf"===e.type)),r=t.length-a.length;if(r>0&&n({show:!0,text:`${r} Datei(en) wurden ignoriert. Nur PDF-Dateien werden unterstützt.`}),a.length>0){const e=[...S,...a].slice(0,5);A(e),$(!1),S.length+a.length>5&&n({show:!0,text:"Maximal 5 Dateien können hochgeladen werden."})}}},onClick:()=>{const e=document.getElementById("file-input");e&&e.click()}},a.createElement(T.A,{size:24}),a.createElement("p",null,"PDF-Dateien hierher ziehen oder klicken zum Auswählen (",S.length,"/5)",B&&S.length>0&&a.createElement("span",{className:e.ocrCompletedMessage},a.createElement(R.A,{size:16,className:e.checkIcon}),"OCR abgeschlossen")),a.createElement("input",{id:"file-input",type:"file",accept:"application/pdf",className:e.hiddenInput,multiple:!0,onChange:e=>{if(e.target.files&&e.target.files.length>0){const t=Array.from(e.target.files),a=t.filter((e=>"application/pdf"===e.type)),r=t.length-a.length;if(r>0&&n({show:!0,text:`${r} Datei(en) wurden ignoriert. Nur PDF-Dateien werden unterstützt.`}),a.length>0){const e=[...S,...a].slice(0,5);A(e),$(!1),S.length+a.length>5&&n({show:!0,text:"Maximal 5 Dateien können hochgeladen werden."})}}},"aria-label":"PDF-Datei auswählen"})),S.length>0&&a.createElement("div",{style:{marginBottom:"15px"}},S.map(((t,n)=>a.createElement("div",{key:n,className:e.filePreview},a.createElement(F.A,{size:20,className:e.fileIcon}),a.createElement("span",{className:e.fileName},t.name),a.createElement(z.A,{size:18,className:e.removeButton,onClick:()=>(e=>{const t=[...S];t.splice(e,1),A(t),0===t.length&&($(!1),K([]))})(n)}))))),a.createElement(b.$,{className:e.button_send,appearance:"primary",onClick:()=>{if((()=>{var e;let t=!0;var n=null!=(e=i.current)?e:"";return" "==n&&(n=J,localStorage.setItem("answer",n)),""==(n=n.trim())?(s({current:n,state:"error"}),t=!1):s({current:n,state:"none"}),t})()){localStorage.setItem("answer",i.current),w(i.current);var e=localStorage.getItem("apiKey");""!=e?S.length>0&&!B?n({show:!0,text:"Bitte warten Sie, bis die OCR-Verarbeitung der PDF-Dateien abgeschlossen ist, bevor Sie eine Antwort generieren."}):function(e){I(this,null,(function*(){Office.context.mailbox.item.subject.getAsync((t=>{if(t.status===Office.AsyncResultStatus.Failed)return;const n=t.value;Office.context.mailbox.item.from.getAsync((t=>{if(t.status===Office.AsyncResultStatus.Failed)return;const a=t.value.emailAddress,r=a;Office.context.mailbox.item.to.getAsync((t=>{if(t.status===Office.AsyncResultStatus.Failed)return;const l=t.value.map((e=>e.emailAddress));Office.context.mailbox.item.cc.getAsync((t=>{if(t.status===Office.AsyncResultStatus.Failed)return;const o=t.value.map((e=>e.emailAddress));Office.context.mailbox.item.body.getAsync(Office.CoercionType.Text,(t=>{if(t.status===Office.AsyncResultStatus.Failed)return;const i=t.value;e({subject:n,sender:a,body:i,user_email:r,recipients:l,cc:o})}))}))}))}))}))}))}((t=>{l(!0);var a=i.current;C("/outlook/generate-email",e,t.subject,t.sender,t.body,a,t.user_email,t.recipients,t.cc,S.length>0?S:void 0).then((e=>W(void 0,null,(function*(){l(!1),"success"==e.status?function(e){I(this,null,(function*(){var t;try{null==(t=Office.context.mailbox.item)||t.body.setSelectedDataAsync(e,{coercionType:Office.CoercionType.Text},(e=>{if(e.status===Office.AsyncResultStatus.Failed)throw e.error.message}))}catch(e){}}))}(e.email_text):n({show:!0,text:e.detail})})))).catch((e=>{l(!1),n({show:!0,text:`Request error: ${e}`})}))})):n({show:!0,text:"API-Schlüssel nicht angegeben"})}}},"Antwort generieren")))},X=n(14852),Y=n(64583).Promise,ee=Object.defineProperty,te=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,oe=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ie=(e,t)=>{for(var n in t||(t={}))re.call(t,n)&&oe(e,n,t[n]);if(ae)for(var n of ae(t))le.call(t,n)&&oe(e,n,t[n]);return e},se=(e,t)=>te(e,ne(t));const ce=(0,l.n)({root:{flexDirection:"column",display:"flex",paddingLeft:"10px",paddingRight:"10px"},saving_dialog:{flexDirection:"column",display:"flex"},dialog_field:{fontWeight:600,marginBottom:"15px"},dialog_add:{width:"100%",marginBottom:"10px"}});var ue=()=>{const e=ce(),[t,n]=a.useState({show:!1,text:""}),[r,l]=a.useState({current:"",state:"none"});a.useEffect((()=>{var e,t,n;e=void 0,t=null,n=function*(){var e=localStorage.getItem("apiKey");l({current:e,state:"none"})},new Y(((a,r)=>{var l=e=>{try{i(n.next(e))}catch(e){r(e)}},o=e=>{try{i(n.throw(e))}catch(e){r(e)}},i=e=>e.done?a(e.value):Y.resolve(e.value).then(l,o);i((n=n.apply(e,t)).next())}))}),[]);return a.createElement("div",{className:e.root,role:"tabpanel","aria-labelledby":"Settings"},t.show&&a.createElement(N,{type:"modal",title:"Info",content:t.text,closeName:"OK",showPrimary:!1,onResultDialog:()=>{n(se(ie({},t),{show:!1}))}}),a.createElement("div",{className:e.saving_dialog},a.createElement(h.D,{className:e.dialog_field,label:"API-Schlüsselwert",validationState:r.state,validationMessage:"Kopieren Sie Ihren API-Schlüsselwert und fügen Sie ihn ein",required:!0},a.createElement(X.p,{value:r.current,placeholder:"z.b. outlookapi47eda17f38081e...",onChange:e=>{l(se(ie({},r),{current:e.target.value}))}})),a.createElement(b.$,{className:e.dialog_add,appearance:"primary",onClick:()=>{var e;e=r.current.trim(),l(se(ie({},r),{current:e,state:"none"})),localStorage.setItem("apiKey",r.current),n({show:!0,text:"Änderungen gespeichert"})}},"Speichern")))};const de=(0,l.n)({root:{alignItems:"flex-start",display:"flex",flexDirection:"column",justifyContent:"flex-start",paddingTop:"10px",paddingLeft:"1px",paddingRight:"1px"},tab_menu:{paddingBottom:"20px"},tab_cont:{width:"100%"}}),pe=()=>{const e=de();var t=localStorage.getItem("apiKey");const[n,r]=a.useState(""==t?"settings":"answer");return a.createElement("div",{className:e.root},a.createElement(i.w,{className:e.tab_menu,selectedValue:n,onTabSelect:(e,t)=>{r(t.value)}},a.createElement(s.o,{id:"Answer",value:"answer"},"Antwort"),a.createElement(s.o,{id:"Settings",value:"settings"},"Einstellungen")),a.createElement("div",{className:e.tab_cont},"answer"===n&&a.createElement(Q,null),"settings"===n&&a.createElement(ue,null)))};const me=(0,l.n)({root:{minHeight:"100vh",maxWidth:"370px"},divider:{marginTop:"10px"}});var fe=()=>{const e=me();return a.createElement("div",{className:e.root},a.createElement(pe,null),a.createElement(o.c,{className:e.divider,inset:!0}))},ge=n(37786),he=n(81722),ye=Object.defineProperty,ve=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,we=(e,t,n)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const Ee=((e,t)=>{for(var n in t||(t={}))be.call(t,n)&&we(e,n,t[n]);if(ve)for(var n of ve(t))xe.call(t,n)&&we(e,n,t[n]);return e})({},(0,ge.a)({10:"#010101",20:"#010202",30:"#010403",40:"#0D1C17",50:"#0F2F25",60:"#0E3D30",70:"#094B3A",80:"#005B46",90:"#216753",100:"#377461",110:"#4B816F",120:"#5F8E7D",130:"#729B8C",140:"#85A99C",150:"#98B7AB",160:"#ACC4BB"})),Oe=document.getElementById("container"),Se=Oe?(0,r.H)(Oe):void 0;Office.onReady((()=>{null==Se||Se.render(a.createElement(he.q,{theme:Ee},a.createElement(fe,null)))}))},39046:function(){}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[96],(function(){return t(88078),t(39046)}));e.O()}]);
//# sourceMappingURL=taskpane.js.map